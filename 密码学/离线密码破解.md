# 破解 hash
密码 hash 破解方法
（1）Extract hashes 提取 hash 值
（2）Format hashes 使用 hash-identify 或者 hashid 确认 hash 的种类
（3）Calculate the cracking time 计算破解时间
（4）Prepare wordlist 准备字典
（5）Attack the hash 爆破字典

## 提取密码 hash
window 中可以使用 [[Windows中敏感信息泄漏#^7f39ab|Get-ChildItem]] 寻找对应的密码 hash 文件
`Get-ChildItem -Path c:\ -Include *.kdbx -File -Recure -ErrorAction silentlyContinue`
linux 中使用 find 命令寻找 hash 文件
`find / -type f -name "hahs文件名称" 2>/dev/null`
## 确认 hash 类型
使用 hash-identify 或者 hashid
`hash-identify 'hash值'`
`hashid hash值`
## 计算破解时间
使用 hashcat 了解 hash 爆破速度
`hashcat -b`
显示 hashcat 破解各种加密方式使用的时间
## 密码变形
有时手中的字典中有些条目不满足密码安全原则，需要删除某些条目或者怎加条目
使用 [[Linux 命令#sed 过滤|sed]] 或者 hashcat 修改 [[字典生成工具|wordlist]] 来符合目标密码安全规则（比如最少 6 位密码，含有大小写）
`sed -i '/^1/d' wordlist.txt`
删除 1 开头的字段
使用 hashcat 对字典进行变形
hashcat -r rule.txt --stdout wordlist.txt
-r 指定规则，存储在 rule. Txt 文件里
`例如：c $1 $2 $!（开头字母大写，在每个字典条目后加上 12！）`
`$1 在字段后面加上 1`
`^1 在字段首部加上 1`
`C 开头字母大写`
`C 开头字母小写`
`L 字母全部小写`
`U 字母全部大写`
`T 3 将位置 3 处的字母大小写切换`
`SXY 将字符 X 替换为 Y`
## 爆破 hash 文件
使用 JtR 套件将提取的 hash 文件格式化
举例：将提取keepass hash数据库格式化
keepass2john Database.kdbx > crackme.hash
格式化后，要使用编辑器删除第一行的文件名称
使用 hashcat 爆破 hash 值
确认 hash 加密方式在 hashcat 中的代号
`hashcat --help | grep -i "需要查找的加密方式"`
爆破 crackme 密文
`hashcat -m 0 crackme.hash /usr/share/wordlist/rockyou.txt -r rule.txt --force` ^1ed614
使用 john 爆破 hash 值
首先编辑 john 配置文件使用 rule 规则爆破
`sudo sh -c 'cat /home/kali/passwordattacks/ssh.rule >> /etc/john/john.conf'`
使用 rule 爆破 ^a16397
`john --wordlist=/usr/share/wordlist/rockyou.txt --rules=sshRule`


# hashcat 混合攻击模式

## -a3 掩码攻击
有时hashcat爆破一个密文并不需要庞大的字典，使用掩码可以在攻击过程中自动生成密文字典
首先确定-a参数
-a 0 常规攻击（使用字典）
-a 1 使用字典中进行组合生成字典
-a 3 使用掩码字典攻击
-a 6 字典+掩码
-a 7 掩码+字典
`hashcat -m 1400 -a 3 hash abc_bcd_?d?d?d?d --force`  使用掩码攻击hash
`abc_bcd_?d?d?d?d` 就是掩码
其中眼吗规则：
![[Pasted image 20240315172603.png]]




